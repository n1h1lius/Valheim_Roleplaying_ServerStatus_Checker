<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Valheim RP Server Checker</title>
<style>
  :root {
    --bg: #f0f4f8;
    --text: #000;
    --container-bg: #fff;
    --section-bg: #f7f9fb;
    --banner-color: #4a90e2;
    --btn-bg: #4a90e2;
    --btn-text: #fff;
    --border: #ccc;
    --json-bg: #000;
    --json-text: #0f0;
  }

  body.dark {
    --bg: #121212;
    --text: #e0e0e0;
    --container-bg: #1e1e1e;
    --section-bg: #2a2a2a;
    --banner-color: #bb86fc;
    --btn-bg: #333;
    --btn-text: #fff;
    --border: #444;
    --json-bg: #111;
    --json-text: #0f0;
  }

  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: var(--bg);
    color: var(--text);
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: background 0.3s, color 0.3s;
  }

  h1 { margin:20px; color:var(--banner-color); text-align:center; }
  .status-banner { font-size:1.5em; font-weight:bold; margin-bottom:15px; }
  .container {
    background: var(--container-bg);
    border-radius:12px;
    box-shadow:0 4px 20px rgba(0,0,0,.1);
    padding:20px;
    max-width:700px;
    width:100%;
    display:flex;
    flex-direction:column;
    gap:10px;
    transition: background 0.3s;
  }
  .main-status { padding:15px; border-radius:8px; background: var(--section-bg); display:flex; flex-direction:column; gap:6px; }
  .main-status div span.label { font-weight:bold; }
  .section { margin:8px 0; }
  .section button {
    width:100%; text-align:left;
    padding:10px; background: var(--btn-bg);
    color: var(--btn-text); border:none;
    border-radius:6px; cursor:pointer;
  }
  .section-content {
    max-height:0; overflow:hidden;
    padding:0 10px;
    border:1px solid var(--border);
    border-radius:6px; background: var(--section-bg);
    transition:max-height 0.3s ease, padding 0.3s ease;
  }
  .section-content.open { padding:10px; }
  .refresh-bar {
    display:flex; justify-content:space-between;
    margin-top:10px; gap:10px;
  }
  .refresh-btn, .darkmode-btn, .show-more-btn {
    flex:1;
    padding:10px; border:none; border-radius:6px;
    background: var(--btn-bg); color: var(--btn-text);
    cursor:pointer; transition: background 0.3s;
  }
  .loading { animation:spin 1s linear infinite; display:inline-block; margin-left:10px; }
  @keyframes spin { from {transform:rotate(0deg);} to {transform:rotate(360deg);} }
  #raw-json {
    max-height:0; overflow:hidden;
    transition:max-height 0.3s ease, padding 0.3s ease;
    background: var(--json-bg); color: var(--json-text);
    font-family:monospace;
    padding:0 10px; margin-top:10px; max-width:700px;
    white-space:pre-wrap; word-break:break-word;
  }
  #raw-json.open { padding:10px; }
</style>
</head>
<body>

<h1 id="title"></h1>
<div class="status-banner" id="server-status-banner">‚è≥ Checking...</div>

<div class="container">
  <div class="main-status" id="main-status">
    <div><span class="label" id="label-ip"></span>: <span id="server-ip"></span></div>
    <div><span class="label" id="label-players"></span>: <span id="player-count"></span></div>
    <div><span class="label" id="label-max-players"></span>: <span id="max-players"></span></div>
    <div><span class="label" id="label-ping"></span>: <span id="ping"></span> ms</div>
  </div>

  <div class="section">
    <button onclick="toggleSection('server-info')" id="btn-server-info"></button>
    <div class="section-content" id="server-info"></div>
  </div>
  <div class="section">
    <button onclick="toggleSection('mods-info')" id="btn-mods-info"></button>
    <div class="section-content" id="mods-info"></div>
  </div>
  <div class="section">
    <button onclick="toggleSection('ports-info')" id="btn-ports-info"></button>
    <div class="section-content" id="ports-info"></div>
  </div>

  <div class="refresh-bar">
    <button class="refresh-btn" onclick="fetchStatus()"><span id="btn-refresh"></span> <span id="loading" class="loading" style="display:none;">‚è≥</span></button>
    <button class="darkmode-btn" onclick="toggleDarkMode()"><span id="btn-darkmode"></span></button>
    <button class="show-more-btn" onclick="toggleRawJSON()"><span id="btn-show-more"></span></button>
  </div>
</div>

<div id="raw-json"></div>

<script>
const API_BASE = '';
const SERVER_IP = '159.223.189.211';
const QUERY_PORT = 2457;

const translations = {
  en: { title: "VALHEIM ROLEPLAYING SERVER", main:{ip:"IP",players:"Players",max_players:"Max Players",ping:"Ping"}, sections:{server_info:"Server Info ‚ñº",mods_info:"Mods Info ‚ñº",ports_info:"Ports ‚ñº",refresh:"Refresh",show_more:"Show JSON",darkmode:"üåô/‚òÄÔ∏è"}, online:"‚úÖ Online", offline:"‚ùå Offline" },
  es: { title:"SERVIDOR VALHEIM ROLEPLAYING", main:{ip:"Direcci√≥n IP",players:"Jugadores",max_players:"M√°x jugadores",ping:"Ping"}, sections:{server_info:"Informaci√≥n del servidor ‚ñº",mods_info:"Informaci√≥n de mods ‚ñº",ports_info:"Puertos ‚ñº",refresh:"Actualizar",show_more:"Mostrar JSON",darkmode:"üåô/‚òÄÔ∏è"}, online:"‚úÖ En l√≠nea", offline:"‚ùå Desconectado"},
  de: { title:"VALHEIM ROLLENSPIEL SERVER", main:{ip:"IP-Adresse",players:"Spieler",max_players:"Max Spieler",ping:"Ping"}, sections:{server_info:"Server Info ‚ñº",mods_info:"Mods Info ‚ñº",ports_info:"Ports ‚ñº",refresh:"Aktualisieren",show_more:"JSON Anzeigen",darkmode:"üåô/‚òÄÔ∏è"}, online:"‚úÖ Online", offline:"‚ùå Offline"},
  fr: { title:"SERVEUR VALHEIM ROLEPLAY", main:{ip:"Adresse IP",players:"Joueurs",max_players:"Joueurs max",ping:"Ping"}, sections:{server_info:"Infos Serveur ‚ñº",mods_info:"Infos Mods ‚ñº",ports_info:"Ports ‚ñº",refresh:"Rafra√Æchir",show_more:"Afficher JSON",darkmode:"üåô/‚òÄÔ∏è"}, online:"‚úÖ En ligne", offline:"‚ùå Hors ligne"},
  it: { title:"SERVER VALHEIM GDR", main:{ip:"Indirizzo IP",players:"Giocatori",max_players:"Max Giocatori",ping:"Ping"}, sections:{server_info:"Info Server ‚ñº",mods_info:"Info Mods ‚ñº",ports_info:"Porte ‚ñº",refresh:"Aggiorna",show_more:"Mostra JSON",darkmode:"üåô/‚òÄÔ∏è"}, online:"‚úÖ Online", offline:"‚ùå Offline"},
  ru: { title:"–°–ï–†–í–ï–† VALHEIM ROLEPLAY", main:{ip:"IP",players:"–ò–≥—Ä–æ–∫–∏",max_players:"–ú–∞–∫—Å. –∏–≥—Ä–æ–∫–∏",ping:"–ü–∏–Ω–≥"}, sections:{server_info:"–ò–Ω—Ñ–æ –æ —Å–µ—Ä–≤–µ—Ä–µ ‚ñº",mods_info:"–ò–Ω—Ñ–æ –æ –º–æ–¥–∞—Ö ‚ñº",ports_info:"–ü–æ—Ä—Ç—ã ‚ñº",refresh:"–û–±–Ω–æ–≤–∏—Ç—å",show_more:"–ü–æ–∫–∞–∑–∞—Ç—å JSON",darkmode:"üåô/‚òÄÔ∏è"}, online:"‚úÖ –û–Ω–ª–∞–π–Ω", offline:"‚ùå –û—Ñ—Ñ–ª–∞–π–Ω"},
  no: { title:"VALHEIM ROLLESPILL SERVER", main:{ip:"IP",players:"Spillere",max_players:"Maks Spillere",ping:"Ping"}, sections:{server_info:"Server Info ‚ñº",mods_info:"Mods Info ‚ñº",ports_info:"Porter ‚ñº",refresh:"Oppdater",show_more:"Vis JSON",darkmode:"üåô/‚òÄÔ∏è"}, online:"‚úÖ Online", offline:"‚ùå Offline"},
  is: { title:"VALHEIM HLUTVERKASPIL SERVER", main:{ip:"IP",players:"Leikmenn",max_players:"H√°marks leikmenn",ping:"Ping"}, sections:{server_info:"Uppl√Ωsingar um Server ‚ñº",mods_info:"Mods uppl√Ωsingar ‚ñº",ports_info:"Portar ‚ñº",refresh:"Uppf√¶ra",show_more:"S√Ωna JSON",darkmode:"üåô/‚òÄÔ∏è"}, online:"‚úÖ √Å netinu", offline:"‚ùå √ìtengt"},
  fi: { title:"VALHEIM ROOLIPELI PALVELIN", main:{ip:"IP",players:"Pelaajat",max_players:"Max Pelaajat",ping:"Ping"}, sections:{server_info:"Palvelimen Tiedot ‚ñº",mods_info:"Modien Tiedot ‚ñº",ports_info:"Portit ‚ñº",refresh:"P√§ivit√§",show_more:"N√§yt√§ JSON",darkmode:"üåô/‚òÄÔ∏è"}, online:"‚úÖ Online", offline:"‚ùå Offline"},
  pl: { title:"SERWER VALHEIM RPG", main:{ip:"Adres IP",players:"Gracze",max_players:"Maks graczy",ping:"Ping"}, sections:{server_info:"Informacje o Serwerze ‚ñº",mods_info:"Informacje o Modach ‚ñº",ports_info:"Porty ‚ñº",refresh:"Od≈õwie≈º",show_more:"Poka≈º JSON",darkmode:"üåô/‚òÄÔ∏è"}, online:"‚úÖ Online", offline:"‚ùå Offline"}
};

const userLang = Object.keys(translations).includes(navigator.language.slice(0,2)) ? navigator.language.slice(0,2) : 'en';
const t = translations[userLang];

// Dynamic labels
document.getElementById('title').textContent = t.title;
document.getElementById('label-ip').textContent = t.main.ip;
document.getElementById('label-players').textContent = t.main.players;
document.getElementById('label-max-players').textContent = t.main.max_players;
document.getElementById('label-ping').textContent = t.main.ping;
document.getElementById('btn-server-info').textContent = t.sections.server_info;
document.getElementById('btn-mods-info').textContent = t.sections.mods_info;
document.getElementById('btn-ports-info').textContent = t.sections.ports_info;
document.getElementById('btn-refresh').textContent = t.sections.refresh;
document.getElementById('btn-show-more').textContent = t.sections.show_more;
document.getElementById('btn-darkmode').textContent = t.sections.darkmode;

function toggleSection(id) {
  const el = document.getElementById(id);
  if(el.classList.contains('open')){
    el.style.maxHeight = '0';
    el.classList.remove('open');
  } else {
    el.style.maxHeight = el.scrollHeight + 'px';
    el.classList.add('open');
  }
}

function toggleRawJSON() {
  const el = document.getElementById('raw-json');
  if(el.classList.contains('open')){
    el.style.maxHeight = '0';
    el.classList.remove('open');
  } else {
    el.style.maxHeight = el.scrollHeight + 'px';
    el.classList.add('open');
  }
}

function toggleDarkMode() {
  document.body.classList.toggle('dark');
}

async function fetchStatus() {
  const loadingEl = document.getElementById('loading');
  const bannerEl = document.getElementById('server-status-banner');
  const ipEl = document.getElementById('server-ip');
  const playersEl = document.getElementById('player-count');
  const maxPlayersEl = document.getElementById('max-players');
  const pingEl = document.getElementById('ping');
  const serverInfoEl = document.getElementById('server-info');
  const modsInfoEl = document.getElementById('mods-info');
  const portsInfoEl = document.getElementById('ports-info');
  const rawJsonEl = document.getElementById('raw-json');

  loadingEl.style.display = 'inline-block';

  try {
    const res = await fetch(`${API_BASE}/api/status?ip=${SERVER_IP}&query_port=${QUERY_PORT}`);
    const data = await res.json();
    const isOnline = data?.ok === true;

    bannerEl.textContent = isOnline ? t.online : t.offline;
    ipEl.textContent = data?.ip || 'N/A';
    playersEl.textContent = data?.player_count ?? 'N/A';
    maxPlayersEl.textContent = data?.info?.max_players ?? 'N/A';
    pingEl.textContent = data?.response_ms ?? 'N/A';

    serverInfoEl.innerHTML = isOnline ? `
      <div><b>Server Name:</b> ${data.info?.server_name || 'N/A'}</div>
      <div><b>Map Name:</b> ${data.info?.map_name || 'N/A'}</div>
      <div><b>Game Version:</b> ${data.info?.version || 'N/A'}</div>
      <div><b>Server Type:</b> ${data.info?.server_type || 'N/A'}</div>
    ` : '<div>Server is offline</div>';

    modsInfoEl.innerHTML = isOnline ? `
      <div><b>Keywords:</b> ${data.info?.keywords || 'N/A'}</div>
    ` : '<div>Server is offline</div>';

    portsInfoEl.innerHTML = isOnline ? `
      <div><b>Game Port:</b> ${data?.game_port ?? 'N/A'}</div>
      <div><b>Query Port:</b> ${data?.query_port ?? 'N/A'}</div>
    ` : '<div>Server is offline</div>';

    rawJsonEl.textContent = JSON.stringify(data ?? {}, null, 2);

  } catch(err) {
    console.warn('Server unreachable or network error.', err);
    bannerEl.textContent = t.offline;
    ipEl.textContent = 'N/A';
    playersEl.textContent = 'N/A';
    maxPlayersEl.textContent = 'N/A';
    pingEl.textContent = 'N/A';
    serverInfoEl.innerHTML = '<div>Server is offline</div>';
    modsInfoEl.innerHTML = '<div>Server is offline</div>';
    portsInfoEl.innerHTML = '<div>Server is offline</div>';
    rawJsonEl.textContent = '{}';
  } finally {
    loadingEl.style.display = 'none';
  }
}

// Apply system dark mode automatically
if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
  document.body.classList.add('dark');
}

window.onload = fetchStatus;
</script>
</body>
</html>
